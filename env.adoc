++++
<link rel="stylesheet"  href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">
++++

:icons: font

= Liste des environnements

== Poste de developpement
- url Application: > http://localhost:4200

== Environnement d'Intégration:

NOTE: Pour tester les devs sur le serveur. Base communes avec les dev 

- url Application: > http://slnxcartodev01.ptx.fr.sopra:4200/application/liste
- url Serveur Neo4J: > http://slnxcartodev01.ptx.fr.sopra:7474/browser/
- url Serveur Backend: > http://slnxcartodev01.ptx.fr.sopra:4000/graphql/

== Environnement de Demo (Prevenir PO avant mise à jour):

IMPORTANT: Version de l'application bloquée pour les démos. A mettre à jour avec les démos de fin de sprint.
Base commune avec Recette. *A mettre à jour sur confirmation du PO ou du CP*.  

- url Application: > http://slnxcartodev01.ptx.fr.sopra:8080/application/liste
- url Serveur Neo4J: > http://slnxcartodev01.ptx.fr.sopra:17474/browser/
- url Serveur Backend: > http://slnxcartodev01.ptx.fr.sopra:14000/graphql/

== Environnement de Recette:

NOTE: Base commune avec Recette. Sert pour valider l'appli sur le même jeux de données que la démo. 

- url Application: > http://slnxcartodev01.ptx.fr.sopra:38080/application/liste
- url Serveur Neo4J: > http://slnxcartodev01.ptx.fr.sopra:17474/browser/
- url Serveur Backend: > http://slnxcartodev01.ptx.fr.sopra:34000/graphql/

== Environnement de Production (Prevenir PO avant mise à jour):

IMPORTANT: Base de production dédiée. *A mettre à jour sur demande du PO ou du CP.* 

- url Application: > http://slnxcartodev01.ptx.fr.sopra:28080/application/liste
- url Serveur Neo4J: > http://slnxcartodev01.ptx.fr.sopra:27474/browser/
- url Serveur Backend: > http://slnxcartodev01.ptx.fr.sopra:24000/graphql/


== PIC
- url: http://slnxcartodev01.ptx.fr.sopra:9080/

*Job de deploiement* 

|===
|Parametre | Description

|branche_ansible
|branche git des playbook Ansible

|branch_ansible_inventory
|branche git des inventaire Ansible

|ENV
|Environnement à deployer

|branch_carto
|branche des projets nodes (doivent être égale)         
|===

= Installation d'un environnement



== Etapes d'installation de l'application

- installation de Neo4J
- Création de la base de données
- Import d'un backup

Etapes de l'installation:

* se connecter en cartousr
* Arret de l'application:  pm2 stop all
* Recuperer le code de la partie cliente
	* cd /app/carto_client
	* git stash
	* git pull
	* git stash pop
	* editer le fichier index.js
	* modifier la ligne ./src/app/app.module.ts
		link: httpLink.create({uri: 'http://localhost:4000/graphql'}),
		
* Recuperer le code de la partie serveur
	* cd cd /app/carto_serveur
	* git pull
	* editer le fichier index.js
	* modifier la ligne
		const neo4jClient =  driver = neo4j.driver("bolt://*********", neo4j.auth.basic("neo4j", "******"));
* Redemarrer l'application
	* pm2 start all 

== Administration Neo4j

=== Arret demarrage

Utiliser les commandes suivantes:

* systemctl enable neo4j	// demarrage automatique de Neo4J
* systemctl start neo4j	// demarrage service
* systemctl stop neo4j	// arret service

=== Dump d'une base de données
cf. https://neo4j.com/docs/operations-manual/3.3/backup/perform-backup/
Note: backup à chaud disponible uniquement en version Enterprise

* systemctl stop neo4j
* neo4j-admin dump --database=graph.db --to=/app/bkp/gragh.db_180525
* systemctl start neo4j
 
 
=== load d'un dump
// à utiliser avec l'utilisateur neo4j

* systemctl stop neo4j
* neo4j-admin load --from=/app/bkp/graph.db/gragh.db_180525 --database=graph.db --force
* systemctl start neo4j

== Neo4j via deamon Docker
 
